/**
 * @author LAMGHAARI Mohammed & MAAD Ali & MASOCCO Angelina
 */


//// region Connexion au fichier json du questionnaire
	var file = Titanium.Filesystem.getFile("/lib/sondages/Windows.json");    
	var json, id, title ,question,questions,logo, repponse;
	var preParseData = (file.read().text); 
	//alert(preParseData);
	var content = JSON.parse(preParseData); 	
//// end region Connexion au fichier json du questionnaire


//// region creation de composants 

var win = Ti.UI.currentWindow;
var view1 = Ti.UI.createView({ backgroundColor:'#fff' });
var view2 = Ti.UI.createView({ backgroundColor:'#fff' });
var view3 = Ti.UI.createView({ backgroundColor:'#fff' });
var view4 = Ti.UI.createView({ backgroundColor:'#fff' });
var view5 = Ti.UI.createView({ backgroundColor:'#fff' });


var validateBtn = Ti.UI.createButton({
	title: 'Valider',
	top: '80%',
	height: 40,
	width: 200,
	layout:'horizontal'
});

var lblQ1 = Ti.UI.createLabel({
	text : content.Q1[0].title,
	height : "auto",
	width : "auto",
	top: '60%',
	textAlign : 'center',
	font:{
    fontSize:18,
    fontWeight:'bold'
   		 },
   	color:'blue'
});

var lblQ2 = Ti.UI.createLabel({
	text : content.Q2[0].title,
	height : "auto",
	width : "auto",
	top: '60%',
	textAlign : 'center',
	font:{
    fontSize:18,
    fontWeight:'bold'
   		 },
   	color:'blue'
});

var lblQ3 = Ti.UI.createLabel({
	text : content.Q3[0].title,
	height : "auto",
	width : "auto",
	top: '60%',
	textAlign : 'center',
	font:{
    fontSize:18,
    fontWeight:'bold'
   		 },
   	color:'blue'
});

var lblQ4 = Ti.UI.createLabel({
	text : content.Q4[0].title,
	height : "auto",
	width : "auto",
	top: '60%',
	textAlign : 'center',
	font:{
    fontSize:18,
    fontWeight:'bold'
   		 },
   	color:'blue'
});

var lblQ5 = Ti.UI.createLabel({
	text : content.Q5[0].title,
	height : "auto",
	width : "auto",
	top: '60%',
	textAlign : 'center',
	font:{
    fontSize:18,
    fontWeight:'bold'
   		 },
   	color:'blue'
});


var tableQ1 = [ {leftImage:"/images/A.png",title: content.rep1[0].choix1,top: '5%'}, {leftImage:"/images/B.png",title: content.rep1[0].choix2}, {leftImage:"/images/C.png",title: content.rep1[0].choix3}, {leftImage:"/images/D.png",title: content.rep1[0].choix4}];
var tableRepQ1 = Ti.UI.createTableView({
  data: tableQ1
});

var tableQ2 = [ {leftImage:"/images/A.png",title: content.rep2[0].choix1,top: '5%'}, {leftImage:"/images/B.png",title: content.rep2[0].choix2}, {leftImage:"/images/C.png",title: content.rep2[0].choix3}, {leftImage:"/images/D.png",title: content.rep2[0].choix4}];
var tableRepQ2 = Ti.UI.createTableView({
  data: tableQ2
});

var tableQ3 = [ {leftImage:"/images/A.png",title: content.rep3[0].choix1,top: '5%'}, {leftImage:"/images/B.png",title: content.rep3[0].choix2}, {leftImage:"/images/C.png",title: content.rep3[0].choix3}, {leftImage:"/images/D.png",title: content.rep3[0].choix4}];
var tableRepQ3 = Ti.UI.createTableView({
  data: tableQ3
});

var tableQ4 = [ {leftImage:"/images/A.png",title: content.rep4[0].choix1,top: '5%'}, {leftImage:"/images/B.png",title: content.rep4[0].choix2}, {leftImage:"/images/C.png",title: content.rep4[0].choix3}, {leftImage:"/images/D.png",title: content.rep4[0].choix4}];
var tableRepQ4 = Ti.UI.createTableView({
  data: tableQ4
});

var tableQ5 = [ {leftImage:"/images/A.png",title: content.rep5[0].choix1,top: '5%'}, {leftImage:"/images/B.png",title: content.rep5[0].choix2}, {leftImage:"/images/C.png",title: content.rep5[0].choix3}, {leftImage:"/images/D.png",title: content.rep5[0].choix4}];
var tableRepQ5 = Ti.UI.createTableView({
  data: tableQ5
});

//// End region creation de composants 


view1.add(tableRepQ1);
view2.add(tableRepQ2);
view3.add(tableRepQ3);
view4.add(tableRepQ4);
view5.add(tableRepQ5);


view1.add(lblQ1);
view2.add(lblQ2);
view3.add(lblQ3);
view4.add(lblQ4);
view5.add(lblQ5);

view5.add(validateBtn);

var scrollableView = Ti.UI.createScrollableView({
  views:[view1,view2,view3,view4,view5],
  showPagingControl:true
});


win.add(scrollableView);

//// Events handle

//tableau qui contient les reponses sur un questionnaire 
var repUser = [0,0,0,0,0];
//Evenement du click sur les TableView
//tableRepQ1.selectionIndicator=true;

var lastSelectedQ1 =null;

tableRepQ1.addEventListener('click',function(e){
	repUser[0]= e.row.title;
	//alert(repUser[1]);
	//alert('title: \'' + e.row.title + '\', index: ' + e.index); 
	
  if (!e.rowData.selected) 
  {
    	if (lastSelectedQ1 != null) 
    	{
    		lastSelectedQ1.setBackgroundColor('white');
    		lastSelectedQ1.selected = false;
    		lastSelectedQ1.hasCheck = false;
    	};
    	e.rowData.setBackgroundColor('purple');
    	e.row.hasCheck = true;
    	lastSelectedQ1 = e.rowData;
  };
  e.rowData.selected = !e.rowData.selected;
});


var lastSelectedQ2 =null;
tableRepQ2.addEventListener('click',function(e){
	repUser[1]= e.row.title;
	
  if (!e.rowData.selected) 
  {
    	if (lastSelectedQ2 != null) 
    	{
    		lastSelectedQ2.setBackgroundColor('white');
    		lastSelectedQ2.selected = false;
    		lastSelectedQ2.hasCheck = false;
    	};
    	e.rowData.setBackgroundColor('purple');
    	e.row.hasCheck = true;
    	lastSelectedQ2 = e.rowData;
  };
  e.rowData.selected = !e.rowData.selected;
});

var lastSelectedQ3 =null;
tableRepQ3.addEventListener('click',function(e){
	repUser[2]= e.row.title;
	
  if (!e.rowData.selected) 
  {
    	if (lastSelectedQ3 != null) 
    	{
    		lastSelectedQ3.setBackgroundColor('white');
    		lastSelectedQ3.selected = false;
    		lastSelectedQ3.hasCheck = false;
    	};
    	e.rowData.setBackgroundColor('purple');
    	e.row.hasCheck = true;
    	lastSelectedQ3 = e.rowData;
  };
  e.rowData.selected = !e.rowData.selected;
});

var lastSelectedQ4 =null;
tableRepQ4.addEventListener('click',function(e){
	repUser[3]= e.row.title;
	
  if (!e.rowData.selected) 
  {
    	if (lastSelectedQ4 != null) 
    	{
    		lastSelectedQ4.setBackgroundColor('white');
    		lastSelectedQ4.selected = false;
    		lastSelectedQ4.hasCheck = false;
    	};
    	e.rowData.setBackgroundColor('purple');
    	e.row.hasCheck = true;
    	lastSelectedQ4 = e.rowData;
  };
  e.rowData.selected = !e.rowData.selected;
});

var lastSelectedQ5 =null;
tableRepQ5.addEventListener('click',function(e){
	repUser[4]= e.row.title;
	
  if (!e.rowData.selected) 
  {
    	if (lastSelectedQ5 != null) 
    	{
    		lastSelectedQ5.setBackgroundColor('white');
    		lastSelectedQ5.selected = false;
    		lastSelectedQ5.hasCheck = false;
    	};
    	e.rowData.setBackgroundColor('purple');
    	e.row.hasCheck = true;
    	lastSelectedQ5 = e.rowData;
  };
  e.rowData.selected = !e.rowData.selected;
});

// Validate Button Event 
validateBtn.addEventListener('click', function() {

	// Alert
	var msgTitle = "Confirmation";
	var msgText = "Voullez vous valider le questionnaire!";
	var alertBox = Ti.UI.createAlertDialog({
						title: msgTitle,
						message: msgText
					});
    alertBox.show();
    alert(repUser);
    //$.tabGroup.open();
    //winSondages.open();
    //win.add(winSondages);
});

//// End Events handle
